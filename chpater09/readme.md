# 9μ¥. JWTλ΅ λ΅κ·ΈμΈ/λ΅κ·Έμ•„μ›ƒ κµ¬ν„ν•κΈ°
## 9.1 μ‚¬μ „μ§€μ‹: ν† ν° κΈ°λ° μΈμ¦
### 9.1.1 ν† ν° κΈ°λ° μΈμ¦μ΄λ€?
__ν† ν°__: μ„λ²„μ—μ„ ν΄λΌμ΄μ–ΈνΈλ¥Ό κµ¬λ¶„ν•κΈ° μ„ν• μ μΌν• κ°’  
μ„λ²„κ°€ ν† ν°μ„ μƒμ„±ν•΄μ„ ν΄λΌμ΄μ–ΈνΈμ—κ² μ κ³µ β†’ ν΄λΌμ΄μ–ΈνΈλ” μ—¬λ¬ μ”μ²­μ„ μ €μ¥ν• ν† ν°κ³Ό ν•¨κ» μ‹ μ²­ β†’ μ„λ²„λ” ν† ν°λ§ λ³΄κ³  μ ν¨ν• μ‚¬μ©μμΈμ§€ κ²€μ¦  

- λ¬΄μƒνƒμ„±: ν† ν°μ μƒμ„±κ³Ό μ μ§€(μƒνƒ κ΄€λ¦¬)λ” ν΄λΌμ΄μ–ΈνΈμ—μ„ μ΄λ£¨μ–΄μ§€λ―€λ΅ μ„λ²„λ” μ™„μ „ν• λ¬΄μƒνƒ(stateless)λ΅ ν¨μ¨μ μΈ κ²€μ¦μ΄ κ°€λ¥
- ν™•μ¥μ„±: μ„λ²„λ¥Ό ν™•μ¥ν•  λ• μƒνƒ κ΄€λ¦¬λ¥Ό μ‹ κ²… μ“Έ ν•„μ”κ°€ μ—†μ–΄ μ„λ²„ ν™•μ¥λ„ μ©μ΄ν•¨. ν† ν°μ„ κ°€μ§€λ” μ£Όμ²΄κ°€ ν΄λΌμ΄μ–ΈνΈμ΄κΈ° λ•λ¬Έμ— μ—¬λ¬ μ„λ²„μ— μ”μ²­μ„ λ³΄λ‚Ό μ μμ
- λ¬΄κ²°μ„±: ν† ν°μ„ λ°κΈ‰ν• μ΄ν›„μ—λ” ν† ν° μ •λ³΄λ¥Ό λ³€κ²½ν•  μ μ—†μ. λ³€κ²½λλ©΄ μ ν¨ν•μ§€ μ•μ€ ν† ν°μ΄ λ¨

### 9.1.2 JWT
β“ __JWT(Json Web Token)__: Json κ°μ²΄μ— μΈμ¦μ— ν•„μ”ν• μ •λ³΄λ“¤μ„ λ‹΄μ€ ν›„ λΉ„λ°€ν‚¤λ΅ μ„λ…ν• ν† ν° (μΈν„°λ„· ν‘μ¤€ μΈμ¦ λ°©μ‹)  
JWTλ¥Ό μ΄μ©ν• μΈμ¦: HTTP μ”μ²­ ν—¤λ” μ¤‘ Authorization ν‚¤κ°’μ— Bearer + JWT ν† ν°κ°’μ„ λ„£μ–΄ λ³΄λ‚΄μ•Ό ν•¨  
> HTTPμ connectionless, stateless νΉμ„± λ•λ¬Έμ— λ§¤ μ”μ²­λ§λ‹¤ JWTλ¥Ό λ³΄λ‚΄λ” κ²ƒ


JWTμ κµ¬μ΅°: ν—¤λ”.λ‚΄μ©.μ„λ…  

- __ν—¤λ”(Header)__: ν† ν°μ νƒ€μ…κ³Ό ν•΄μ‹± μ•κ³ λ¦¬μ¦μ„ μ§€μ •ν•λ” μ •λ³΄
    + ```java
      {
        "typ": "JWT",
        "alg": "HS256"
      }
      ```
    + HS256: λΉ„λ°€ν‚¤
    + RS256: κ³µκ°ν‚¤
    > π”‘ S256: λ°μ΄ν„° λ¬΄κ²°μ„±μ„ μ„ν•΄ μ‚¬μ©λλ” μ•”νΈν™” ν•΄μ‰¬ μ•κ³ λ¦¬μ¦(SHA256)μ„ μλ―Έ. 2^256κ°€μ§€μ κ²½μ°μ μ
    > - HS256: λ€μΉ­ν‚¤ μ•”νΈν™” μ•κ³ λ¦¬μ¦ (κ°™μ€ ν‚¤λ΅ μ•”νΈν™”/λ³µνΈν™”, λΉ„λ°€ν‚¤λ¥Ό μ•κ³  μλ” μ„λ²„λ§ μ ν¨μ„± κ²€μ¦ λ° λ³µνΈν™” κ°€λ¥)
    > - RS256: λΉ„λ€μΉ­ν‚¤ μ•”νΈν™” μ•κ³ λ¦¬μ¦ (λ‹¤λ¥Έ ν‚¤λ΅ μ•”νΈν™”/ λ³µνΈν™”, λΉ„λ°€ν‚¤λ¥Ό λ°λΌλ„ κ³µκ°ν‚¤λ΅ μ ν¨μ„± κ²€μ¦ λ° λ³µνΈν™” κ°€λ¥)
- __λ‚΄μ©(Payload)__: ν† ν°κ³Ό κ΄€λ ¨λ μ •λ³΄
    + ν΄λ μ„: λ‚΄μ©μ ν• λ©μ–΄λ¦¬. ν‚¤κ°’μ ν•μμΌλ΅ μ΄λ£¨μ–΄μ§
        * λ“±λ΅λ ν΄λ μ„: ν† ν°μ— λ€ν• μ •λ³΄λ¥Ό λ‹΄λ” λ° μ‚¬μ©
            - |μ΄λ¦„|μ„¤λ…|
              |--|--|
              |iss|ν† ν° λ°κΈ‰μ(issuer)|
              |sub|ν† ν° μ λ©(subject)|
              |aud|ν† ν° λ€μƒμ(audience)|
              |exp|ν† ν°μ λ§λ£ μ‹κ°„(expiration)|
              |nbf|ν† ν°μ΄ ν™μ„±λκΈ°κΉμ§€μ λ‚ μ§(not before)|
              |iat|ν† ν°μ λ°κΈ‰ μ‹κ°„(issued at)|
              |jti|JWTμ κ³ μ  μ‹λ³„μ|
        * κ³µκ° ν΄λ μ„: κ³µκ°λμ–΄λ„ μƒκ΄€μ—†λ” ν΄λ μ„. μ΄λ¦„μ€ μ¶©λν•λ©΄ μ•λλ©° λ³΄ν†µ URIλ΅ μ§€μ
        * λΉ„κ³µκ° ν΄λ μ„: κ³µκ°λλ©΄ μ• λλ” ν΄λ μ„. ν΄λΌμ΄μ–ΈνΈ-μ„λ²„ ν†µμ‹ μ— μ‚¬μ©
        * ```java
          "iss": "ajufresh@gmail.com",  // λ“±λ΅λ ν΄λ μ„
          "iat": 1622370878,  // λ“±λ΅λ ν΄λ μ„
          "https://shinsunyoung.com/jwt_claims/is_admin": true,  // κ³µκ° ν΄λ μ„
          "email": "ajufresh@gmail.com"  // λΉ„κ³µκ° ν΄λ μ„ (λ“±λ΅λ ν΄λ μ„λ„ κ³µκ° ν΄λ μ„λ„ μ•„λ‹)
          ```
- __μ„λ…(Signature)__: ν•΄λ‹Ή ν† ν°μ΄ μ΅°μ‘λμ—κ±°λ‚ λ³€κ²½λμ§€ μ•μ•μμ„ ν™•μΈν•λ” μ©λ„λ΅ μ‚¬μ©. ν—¤λ”μ™€ λ‚΄μ©μ μΈμ½”λ”©κ°’μ„ ν•©μΉ ν›„, ν—¤λ”μ μ•κ³ λ¦¬μ¦κ³Ό μ£Όμ–΄μ§„ λΉ„λ°€ν‚¤λ¥Ό μ‚¬μ©ν•΄ ν•΄μ‹κ°’μ„ μƒμ„±(μ•”νΈν™”)  
<br>

__λ¦¬ν”„λ μ‹ ν† ν°__: μ•΅μ„Έμ¤ ν† ν°μ΄ λ§λ£λμ—μ„ λ• μƒλ΅μ΄ μ•΅μ„Έμ¤ ν† ν°μ„ λ°κΈ‰ν•κΈ° μ„ν• ν† ν°  
- μ•΅μ„Έμ¤ ν† ν°μ μ ν¨ κΈ°κ°„μ€ μ§§κ², λ¦¬ν”„λ μ‹ ν† ν°μ μ ν¨ κΈ°κ°„μ€ κΈΈκ² μ„¤μ •ν•λ©΄ λ” μ•μ „ν•΄μ§„λ‹¤  
- μ„λ²„μ—μ„ μƒμ„±λμ–΄ ν΄λΌμ΄μ–ΈνΈμ™€ DBμ—λ„ μ €μ¥ β†’ μ•΅μ„Έμ¤ ν† ν° λ§λ£ μ‹ ν΄λΌμ΄μ–ΈνΈκ°€ λ¦¬ν”„λ μ‹ ν† ν°κ³Ό ν•¨κ» μƒ μ•΅μ„Έμ¤ ν† ν°μ λ°κΈ‰μ„ μ”μ²­ν•¨ β†’ μ„λ²„λ” λ¦¬ν”„λ μ‹ ν† ν°μ΄ μ ν¨ν•μ§€+DBμ λ¦¬ν”„λ μ‹ ν† ν°κ³Ό κ°™μ€μ§€ ν™•μΈν• ν›„ μƒ μ•΅μ„Έμ¤ ν† ν°μ„ μƒμ„±ν•΄ μ‘λ‹µ  
> β“ λ¦¬ν”„λ μ‹ ν† ν°μ΄ νƒμ·¨λλ” κ²½μ°
> - μƒ μ•΅μ„Έμ¤ ν† ν°μ„ μ”μ²­ν•  λ• λ¦¬ν”„λ μ‹ ν† ν°κ³Ό κΈ°μ΅΄μ μ•΅μ„Έμ¤ ν† ν°λ„ ν•¨κ» λ³΄λ‚΄μ„ κ·Έ μμ„ κ²€μ¦ν•λ” λ°©λ²• μ‚¬μ©


> β° λ‹¤λ¥Έ λ°©λ²•: __Sliding Session__
> - μ μ €κ°€ νΉμ • ν–‰λ™μ„ ν•  λ•(κΈ€μ“°κΈ°, κ²°μ  λ“±) λ§λ£μ‹κ°„μ„ λλ¦° μƒ JWTλ¥Ό μ κ³µ
> - Sliding sessionμΌλ΅ μ—°μ¥μ‹μΌμ¤„ μ μ—†λ” μƒν™©, λ„λ¬΄ μ¤λ μ—°μ¥μ‹ν‚¨ μƒν™© λ“±μ΄ μƒκΈ°κΈ°λ„ ν•΄μ„ λ¦¬ν”„λ μ‹ ν† ν°μ΄ κ°€μ¥ λ§μ΄ μ‚¬μ©λ¨
<br>

__JWTμ μ¥μ __

- ν† ν° μμ²΄κ°€ μΈμ¦λ μ •λ³΄μ΄κΈ° λ•λ¬Έμ— λ³„λ„μ μ €μ¥μ†κ°€ ν•„μ”ν•μ§€ μ•μΌλ©° HTTPμ stateless νΉμ„± μ μ§€ν•  μ μμ
- ν† ν°μ΄ λ§λ£λμ—μ„ λ•λ§ μ €μ¥μ†μ— μ ‘κ·Όν•κΈ° λ•λ¬Έμ— μ„Έμ…λ³΄λ‹¤ μ ‘κ·Ό νμκ°€ μ μ
- Signatureλ΅ μΈν•΄ λΉ„κµμ  μ•μ „ν•¨
- HTTP ν—¤λ”λ¥Ό ν†µν•΄ κ°„λ‹¨ν•κ² μ „μ†΅λλ―€λ΅ λ„¤νΈμ›ν¬ λ¶€ν•κ°€ μ μ
- λ‹¤λ¥Έ μ„λΉ„μ¤μ—λ„ μ΄μ©ν•  μ μμ (ν™•μ¥μ„±)

__λ‹¨μ __

- λ³΄μ• λ¬Έμ λ΅ λ¦¬ν”„λ μ‹ ν† ν°μ„ λ„μ…ν•λ©΄ μ΄λ¥Ό μ €μ¥ν•κΈ° μ„ν• λ³„λ„μ μ €μ¥μ†κ°€ ν•„μ”ν•¨ (stateless μ„λ°)
- κ±°μ λ¨λ“  μ”μ²­μ— ν† ν°μ΄ ν¬ν•¨λλ―€λ΅ νΈλν”½ ν¬κΈ°μ— μν–¥μ„ λ―ΈμΉ  μ μμ
- ν† ν°μ ν¬κΈ°κ°€ μ»¤μ§€λ©΄ λ„¤νΈμ›ν¬ λ¶€ν•κ°€ μ»¤μ§
- λ‚΄μ©(payload)λ” μ•”νΈν™”λ κ² μ•„λ‹λΌ νƒμ·¨ λ‹Ήν•λ©΄ μ •λ³΄κ°€ μ μ¶λ  μ μμ β†’ λ‚΄μ©μ—λ” λ―Όκ°ν• μ •λ³΄ μ €μ¥ X
- β— ν† ν°μ΄ νƒμ·¨λ‹Ήν•λ©΄ λ§λ£λ  λ•κΉμ§€ λ€μ²κ°€ λ¶κ°€λ¥ν•¨ (μ„λ²„κ°€ κ΄€λ¦¬ν•  μ X) β†’ λ§λ£μ‹κ°„μ„ μ§§κ²
